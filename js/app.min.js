

function analytics(vc,d,o){var self=this
var data=d
var usr_str=Array('error','New user','Returning user')
var syn_id=vc.syn_id
var vals
var session_log={'origin':syn_id}
self.vc=vc
this.start=function(){if(syn_id=='nhs'){dcsMultiTrack('DCSext.tool_name',data.title,'DCSext.tool_cat',data.category,'DCSext.tool_start','1','DCSext.tool_complete','0','WT.dl','100','DCSext.tool_user_status',usr_str[Math.min(self.vc.stateObj.visits,2)],'DCSext.tool_usage',self.vc.stateObj.visits,'DCSext.visit_tool_usage','','WT.si_n',data.title,'WT.si_x','1');}}
this.advance=function(q_num,total){if(syn_id=='nhs'){if(q_num==total){dcsMultiTrack('DCSext.tool_name',data.title,'DCSext.tool_cat',data.category,'DCSext.tool_start','','DCSext.tool_complete','1','WT.si_n',data.title,'WT.si_x',q_num,'WT.dl','100','DCSext.tool_user_status','','DCSext.tool_usage','','DCSext.visit_tool_usage','');}else{dcsMultiTrack('DCSext.tool_name',data.title,'DCSext.tool_cat',data.category,'DCSext.tool_start','','WT.si_n',data.title,'WT.si_x',q_num,'WT.dl','100','DCSext.tool_user_status','','DCSext.tool_usage','','DCSext.visit_tool_usage','');}}}
this.antbitsLog=function(){session_log=self.vc.form.getData(session_log)
session_log=self.vc.stateObj.getData(session_log)
session_log=self.vc.results.getData(session_log)
session_log.origin=syn_id
session_log.id=data.id
session_log.d=self.vc.device
var output="//change4life.antbits.com/tracking/tracker.gif?"
for(var key in session_log){output+=key+'='+session_log[key]+'&'}
output=output.slice(0,-1)
$.ajax({url:output,dataType:'json',async:false});}
window.onbeforeunload=function(){self.antbitsLog()}}

function LifetimeRiskRow(S_1,cif_cvd,cif_death,S_noDeath,cvd_noDeath){this.S_1=S_1
this.cif_cvd=cif_cvd
this.cif_death=cif_death
this.S_noDeath=S_noDeath
this.cvd_noDeath=cvd_noDeath}

function form(r){var root=r
var self=this;var pos
var $postcode=$('#postcode');var $ch_error=$('#ch_error')
var $ch_error_inner=$('#ch_error_inner')
var $ch_block=$('#ch_block')
var P1Alert=false;var P4Alert=false;var dob=new Date();var now=new Date();var $dob_day=$('#dob_day')
var $dob_month=$('#dob_month')
var $dob_year=$('#dob_year')
var $h_imperial=$('#h_imperial')
var $w_imperial=$('#w_imperial')
var $t_cholesterol_wrap_a=$('#t_cholesterol_wrap_a')
var $t_cholesterol_wrap_b=$('#t_cholesterol_wrap_b')
var $hdl_cholesterol_wrap_a=$('#hdl_cholesterol_wrap_a')
var $hdl_cholesterol_wrap_b=$('#hdl_cholesterol_wrap_b')
var $h_metric=$('#h_metric')
var $w_metric=$('#w_metric')
var scrollH=1000
var $t_cholesterol_a=$('#t_cholesterol_a')
var $hdl_cholesterol_a=$('#hdl_cholesterol_a')
var $t_cholesterol_b=$('#t_cholesterol_b')
var $hdl_cholesterol_b=$('#hdl_cholesterol_b')
var $sys_bp=$('#sys_bp')
var $h_cm=$('#h_cm')
var $h_ft=$('#h_ft')
var $h_in=$('#h_in')
var $w_kg=$('#w_kg')
var $w_st=$('#w_st')
var $w_lb=$('#w_lb')
var $smoke=$('#smoke')
var $ethnicity=$('#ethnicity')
var units={"w":"imperial","h":"imperial","ch":"mmol/L"}
var townsend_api_path='https://change4life.antbits.com/townsend/api.php';var tn_queue=false
var panel_heights={'cholesterol':$('#cholesterol_data').height(),'bp':$('#bp_data').height()};this.__h=null
this.__w=null
this.__t_ch=null
this.__hdl_ch=null
this.defaults={'age':40,'b_AF':false,'b_ra':false,'b_renal':false,'b_treatedhyp':false,'b_type2':false,'bmi':22.49,'ethrisk':1,'fh_cvd':false,'rati':4.583333333333334,'sbp':130,'smoke_cat':0,'town':-0.810}
this.radio_arr=Array({'id':'gender','vals':Array(1,0),'val':null},{'id':'cardio','vals':Array('yes','no'),'val':null},{'id':'cholesterol','vals':Array('yes','no'),'val':null},{'id':'bp','vals':Array('yes','no'),'val':null},{'id':'bpt','vals':Array('yes','no'),'val':null},{'id':'diabetes','vals':Array('yes','no'),'val':null},{'id':'arthritis','vals':Array('yes','no'),'val':null},{'id':'kidney','vals':Array('yes','no'),'val':null},{'id':'af','vals':Array('yes','no'),'val':null},{'id':'rcvd','vals':Array('yes','no'),'val':null});var gender
var townsend_score=self.defaults.town
var region=null
$postcode.on('keyup',function(){self.tnQ()})
$postcode.on('blur',function(){self.tnQ()})
$postcode.width($('#ethnicity').width()-5)
$postcode.on('focus',function(){if($postcode.val()=='e.g CB10 2PS'){$postcode.css('color','#585858').val('')}})
$h_metric.hide()
$w_metric.hide()
$t_cholesterol_wrap_b.hide()
$hdl_cholesterol_wrap_b.hide()
$('#h_imperial>div>a').on('click',function(){self.unitSwap('h','imperial','metric')})
$('#h_metric>div>a').on('click',function(){self.unitSwap('h','metric','imperial')})
$('#w_imperial>div>a').on('click',function(){self.unitSwap('w','imperial','metric')})
$('#w_metric>div>a').on('click',function(){self.unitSwap('w','metric','imperial')})
$('#hdl_cholesterol_wrap_a>div>a').on('click',function(){self.unitSwap('t_cholesterol_wrap','a','b')
self.unitSwap('hdl_cholesterol_wrap','a','b')})
$('#hdl_cholesterol_wrap_b>div>a').on('click',function(){self.unitSwap('t_cholesterol_wrap','b','a')
self.unitSwap('hdl_cholesterol_wrap','b','a')})
$w_kg.on('keyup',function(){self.checkWeight('kg')})
$w_st.on('keyup',function(){self.checkWeight('st')})
$w_lb.on('keyup',function(){self.checkWeight('lb')})
$h_cm.on('keyup',function(){self.checkHeight('cm')})
$h_ft.on('keyup',function(){self.checkHeight('ft')})
$h_in.on('keyup',function(){self.checkHeight('in')})
$t_cholesterol_wrap_a.on('keyup',function(e){if(keyEvtNumeric(e)){self.checkCholesterol('mmol/L')}})
$hdl_cholesterol_wrap_a.on('keyup',function(e){if(keyEvtNumeric(e)){self.checkCholesterol('mmol/L')}})
$t_cholesterol_wrap_b.on('keyup',function(e){if(keyEvtNumeric(e)){self.checkCholesterol('mg/dl')}})
$hdl_cholesterol_wrap_b.on('keyup',function(e){if(keyEvtNumeric(e)){self.checkCholesterol('mg/dl')}})
$t_cholesterol_a.on('keyup',function(){self.storeState()})
$hdl_cholesterol_a.on('keyup',function(){self.storeState()})
$t_cholesterol_b.on('keyup',function(){self.storeState()})
$hdl_cholesterol_b.on('keyup',function(){self.storeState()})
$sys_bp.on('keyup',function(){if(!isNaN($sys_bp.val())){$sys_bp.val(Math.max(Math.min($sys_bp.val(),210),0))}
self.storeState()})
$('#postcode_info').on('click',function(){root.dialog('1C4')})
$('#ethnicity_info').on('click',function(){root.dialog('1C6')})
$('#cv_info').on('click',function(){root.dialog('1C5')})
$('#cholesterol_info').on('click',function(){root.dialog('3C1')})
$('#bp_info').on('click',function(){root.dialog('3C2')})
$('#bpt_info').on('click',function(){root.dialog('3C3')})
$('#cvd_info').on('click',function(){root.dialog('4C5')})
$ethnicity.on('change',function(){self.storeState()})
$smoke.on('change',function(){self.storeState()})
this.tnQ=function(){if(!tn_queue){tn_queue=true
setTimeout(function(){self.checkTownsend()
tn_queue=false;},2000)}}
this.checkCholesterol=function(val){if(val=='mmol/L'){pos=$hdl_cholesterol_a.offset()
if(isNaN(parseFloat($t_cholesterol_a.val()))){$t_cholesterol_a.val('')
$t_cholesterol_b.val('')
self.__t_ch=0}else{self.__t_ch=Math.max(Math.min(parseFloat($t_cholesterol_a.val()),20),0);if($t_cholesterol_a.val().slice(-1)!='.'){$t_cholesterol_a.val(self.__t_ch)}
$t_cholesterol_b.val((self.__t_ch*38.66976).toFixed(0))}
if(isNaN(parseFloat($hdl_cholesterol_a.val()))){$hdl_cholesterol_a.val('')
$hdl_cholesterol_b.val('')
self.__hdl_ch=0}else{self.__hdl_ch=Math.max(Math.min(parseFloat($hdl_cholesterol_a.val()),12),0);if($hdl_cholesterol_a.val().slice(-1)!='.'){$hdl_cholesterol_a.val(self.__hdl_ch)}
$hdl_cholesterol_b.val((self.__hdl_ch*38.66976).toFixed(0))}}else{pos=$hdl_cholesterol_b.offset()
if(isNaN(parseFloat($t_cholesterol_b.val()))){$t_cholesterol_a.val('')
$t_cholesterol_b.val('')
self.__t_ch=0}else{self.__t_ch=Math.max(Math.min(parseFloat($t_cholesterol_b.val()),774),0);if($t_cholesterol_b.val().slice(-1)!='.'){$t_cholesterol_b.val(self.__t_ch)}
$t_cholesterol_a.val((self.__t_ch*0.02586).toFixed(1))}
if(isNaN(parseFloat($hdl_cholesterol_b.val()))){$hdl_cholesterol_a.val('')
$hdl_cholesterol_b.val('')
self.__hdl_ch=0}else{self.__hdl_ch=Math.max(Math.min(parseFloat($hdl_cholesterol_b.val()),464),0);if($hdl_cholesterol_b.val().slice(-1)!='.'){$hdl_cholesterol_b.val(self.__hdl_ch)}
$hdl_cholesterol_a.val((self.__hdl_ch*0.02586).toFixed(1))}}
if(self.__hdl_ch>self.__t_ch&&$hdl_cholesterol_a.val()!=''&&$t_cholesterol_a.val()!=''){self.chError(0,pos)}else if(self.__t_ch/self.__hdl_ch>12.5&&$hdl_cholesterol_a.val()!=''&&$t_cholesterol_a.val()!=''){self.chError(1,pos)}else{self.chError(2,pos)}
self.storeState()}
this.chError=function(opt,pos){if(pos.left==0||pos.right==0){opt=2}else{if(root.qstr.layout=='phone'){$ch_error.css('left',pos.left).css('top',pos.top-58)}else{$ch_error.css('left',pos.left).css('top',pos.top-70)}}
switch(opt){case 0:$ch_error.fadeIn(root.speed)
$ch_error_inner.html('Cholesterol ratio too small please check')
$hdl_cholesterol_a.css('border','2px solid #ef6167').css('background-color','#fad2d4').css('margin','0px')
$hdl_cholesterol_b.css('border','2px solid #ef6167').css('background-color','#fad2d4').css('margin','0px')
break;case 1:$ch_error.fadeIn(root.speed)
$ch_error_inner.html('Cholesterol ratio too big please check')
$hdl_cholesterol_a.css('border','2px solid #ef6167').css('background-color','#fad2d4').css('margin','0px')
$hdl_cholesterol_b.css('border','2px solid #ef6167').css('background-color','#fad2d4').css('margin','0px')
break;case 2:$ch_error.fadeOut(root.speed)
$hdl_cholesterol_a.css('border','1px solid #a9a9a9').css('background-color','#fff').css('margin','1px')
$hdl_cholesterol_b.css('border','1px solid #a9a9a9').css('background-color','#fff').css('margin','1px')
self.highlightBlock('t_cholesterol_a','off')
break;}}
this.checkWeight=function(val){if(val=='kg'){if(isNaN(parseFloat($w_kg.val()))){$w_kg.val('')
$w_st.val('')
$w_lb.val('')
self.__w=0}else{self.__w=parseFloat($w_kg.val());var stone=Math.floor(self.__w*0.157473)
var lbs=Math.round(self.__w*2.204622)-(stone*14)
if(lbs==14){lbs=0
stone++}
$w_st.val(stone)
$w_lb.val(lbs)}}else{var w=0
var pounds=parseInt($w_lb.val(),10)
var stone=parseInt($w_st.val(),10)
if(isNaN(stone)){$w_st.val('')
$w_kg.val('')
self.__w=0}else{w+=(parseInt($w_st.val(),10)/0.157473);}
if(isNaN(pounds)){$w_lb.val('')}else{$w_lb.val(Math.max(0,Math.min(14,pounds)))
w+=(parseInt($w_lb.val(),10)/2.204622)}
if(w>0){self.__w=w
$w_kg.val(Math.round(w*10)/10)}}
self.storeState()}
this.checkHeight=function(val){if(val=='cm'){if(isNaN(parseInt($h_cm.val(),10))){$h_cm.val('')
$h_ft.val('')
$h_in.val('')
self.__h=0}else{self.__h=parseFloat($h_cm.val(),10);var feet=Math.floor(self.__h/30.48)
var inches=Math.round(self.__h/2.54)-(feet*12)
if(inches==12){inches=0
feet++}
$h_ft.val(feet)
$h_in.val(inches)}}else{var h=0
var inches=parseInt($h_in.val(),10)
var feet=parseInt($h_ft.val(),10)
if(isNaN(feet)){$h_ft.val('')
$h_cm.val('')
self.__h=0;}else{h+=parseInt($h_ft.val(),10)*30.48;}
if(isNaN(inches)){$h_in.val('')}else{$h_in.val(Math.max(0,Math.min(11,inches)))
h+=parseInt($h_in.val(),10)*2.54}
if(h>0){self.__h=h
$h_cm.val(Math.round(h*10)/10)}}
self.storeState()}
this.checkDob=function(){if(parseInt($dob_day.val())>0&&parseInt($dob_day.val())<=32&&parseInt($dob_month.val())>0&&parseInt($dob_month.val())<=12&&parseInt($dob_year.val())>1890&&parseInt($dob_year.val())<=now.getFullYear()){dob=new Date($dob_year.val(),($dob_month.val()-1),$dob_day.val())
self.storeState('dob')
return true}else{return false}}
this.unitSwap=function(id,hide,show){$('#'+id+'_'+show).fadeIn(root.speed)
$('#'+id+'_'+hide).fadeOut(root.speed)}
this.initRadio=function(){function radio_over(e){var id=e.target.id
if(e.target.nodeName!='A'){id=e.target.parentNode.id}
var img=$('#'+id+'>img')
if(img.attr('src').indexOf('_on')==-1){img.attr('src',img.attr('src').replace('_off','_over'))}}
function radio_out(e){var id=e.target.id
if(e.target.nodeName!='A'){id=e.target.parentNode.id}
var img=$('#'+id+'>img')
if(img.attr('src').indexOf('_on')==-1){img.attr('src',img.attr('src').replace('_over','_off'))}}
for(var i in this.radio_arr){for(var j in this.radio_arr[i].vals){var $tmp=$('#'+this.radio_arr[i].id+'_'+this.radio_arr[i].vals[j]);$tmp.on('click',function(e){self.toggleRadio(e)});$tmp.on('mouseover',function(e){radio_over(e)});$tmp.on('focus',function(e){radio_over(e)});$tmp.on('mouseout',function(e){radio_out(e)});$tmp.on('blur',function(e){radio_out(e)});}}}
this.checkTownsend=function(){var regPostcode=/[A-Z]{1,2}[0-9][0-9A-Z]?\s?[0-9][A-Z]{2}/gi;var postcode=$postcode.val();if(regPostcode.test(postcode)){$postcode.val(postcode.toUpperCase().replace(' ',''))
$.getJSON(townsend_api_path+'?p='+postcode,function(data){if(!isNaN(parseFloat(data.townsend_score))){townsend_score=parseFloat(data.townsend_score);region=data.region
self.storeState()}});}else{townsend_score=self.defaults.town}}
this.storeState=function(){var obj={"bmi":self.bmi(),"radio_arr":this.radio_arr,"townsend_score":townsend_score,"region":region,"page":root.page,"units":units,"dob":dob,"t_cholesterol":$t_cholesterol_a.val(),"hdl_cholesterol":$hdl_cholesterol_a.val(),"sys_bp":$sys_bp.val(),"postcode":$postcode.val(),"w":self.__w,"h":self.__h,"smoke":$smoke.val(),"ethnicity":$ethnicity.val()}
root.stateObj.storeState(obj)}
this.dobComboSet=function(init,e){if(init){var output=''
var y=dob.getFullYear()-30;var m=dob.getMonth()+1;var d=dob.getDate();for(var i=0;i>-57;i--){output+='<option value = "'+(y+i)+'">'+(y+i)+'</option>'}
$dob_year.html(output);y-=10
$dob_year.val(y)
$dob_month.val(m)
$dob_year.on('change',function(){self.checkDob()
self.updateDays($dob_day.val(),$dob_month.val(),$dob_year.val())})
$dob_month.on('change',function(){self.checkDob()
self.updateDays($dob_day.val(),$dob_month.val(),$dob_year.val())})
$dob_day.on('change',function(){self.checkDob()})
self.updateDays(d,$dob_month.val(),$dob_year.val())}}
this.zeroFill=function(number,width){width-=number.toString().length;if(width>0){return new Array(width+(/\./.test(number)?2:1)).join('0')+number;}
return number+"";}
this.updateDays=function(d,m,y){var days=new Date(y,m,0).getDate();var output=''
for(var i=1;i<=days;i++){output+='<option value = "'+i+'">'+self.zeroFill(i,2)+'</option>'}
$dob_day.html(output);$dob_day.val(Math.min(d,days))}
this.toggleRadio=function(e){if(e.target.tagName=='A'){var tmp=e.target.id.split('_');}else{var tmp=e.target.parentNode.id.split('_');}
for(var i in this.radio_arr){if(this.radio_arr[i].id==tmp[0]){if(this.radio_arr[i].val==null){this.radio_arr[i].val=tmp[1];}else{if(this.radio_arr[i].val==this.radio_arr[i].vals[1]){this.radio_arr[i].val=this.radio_arr[i].vals[0];}else{this.radio_arr[i].val=this.radio_arr[i].vals[1];}}
for(var j in this.radio_arr[i].vals){var tmp=$('#'+this.radio_arr[i].id+'_'+this.radio_arr[i].vals[j]+'>img')
if(this.radio_arr[i].vals[j]==this.radio_arr[i].val){tmp.attr('src','images/radio_on'+root.img_str+'.png')}else{tmp.attr('src','images/radio_off'+root.img_str+'.png')}
self.highlightBlock(this.radio_arr[i].id+'_'+this.radio_arr[i].vals[0],'off')
self.checkHiddenPanels(this.radio_arr[i].id,this.radio_arr[i].val,false)
self.checkP1Alert(this.radio_arr[i].id,this.radio_arr[i].val)
self.checkP4Alert(this.radio_arr[i].id,this.radio_arr[i].val)
self.checkP41Alert(this.radio_arr[i].id,this.radio_arr[i].val)}}}
self.storeState()}
this.checkP4Alert=function(id,state){var str="_diabetes_arthritis_kidney_af_"
if(str.indexOf(id)>0&&state=='yes'&&P4Alert==false){P4Alert=true;root.dialog('4C1-4')}}
this.checkP41Alert=function(id,state){if(id=='rcvd'&&state=='yes'){root.dialog('4C1-5')}}
this.checkP1Alert=function(id,state){if(id=='cardio'&&state=='yes'&&P1Alert==false){P1Alert=true;root.dialog('1C3')}}
this.checkHiddenPanels=function(id,state,snap){if((id=="cholesterol"||id=="bp")&&state!=null){var $p1=$('#'+id+'_data')
var $p2=$('#'+id+'_data_alt')
var spd=r.speed/2
if(snap){spd=0}
var delay=spd*2.2
if($p1.css('display')=='none'&&$p2.css('display')=='none'){delay=0}
if(state=='yes'){$p2.slideUp(spd)
$p1.delay(delay).slideDown(spd)}else if(state=='no'){$p2.delay(delay).slideDown(spd)
$p1.slideUp(spd)}
var t=0
var tracker=setInterval(function(){r.$nav.css('top',$('#page_'+r.page).height()+90)
t+=(r.speed/100)
if(t>=(r.speed/2)+delay){clearInterval(tracker)}},10)}

if(id=="cholesterol"){if(state=='no'){self.chError(2,pos)}else{setTimeout(function(){self.checkCholesterol('mmol/L')},1000)}}}
this.bmi=function(){this.__h=parseFloat($('#h_cm').val())
this.__w=parseFloat($('#w_kg').val())
if(!isNaN(this.__h)&&!isNaN(this.__w)){return this.__w/(Math.pow((this.__h/100),2))}else{return self.defaults.bmi}}
this.restoreState=function(obj){this.radio_arr=obj.radio_arr
townsend_score=obj.townsend_score
region=obj.region
units=obj.units
dob=new Date(obj.dob)
if(now.getFullYear()-dob.getFullYear()>=30){$dob_day.val(dob.getDate())
$dob_month.val(dob.getMonth()+1)
$dob_year.val(dob.getFullYear())
self.updateDays(dob.getDate(),dob.getMonth()+1,dob.getFullYear())}else{dob=new Date();}
if(obj.postcode!='e.g CB10 2PS'){$postcode.css('color','#585858').val(obj.postcode)}
self.__w=obj.w
self.__h=obj.h
$h_cm.val(obj.h)
$w_kg.val(obj.w)
$smoke.val(obj.smoke);$ethnicity.val(obj.ethnicity)
$t_cholesterol_a.val(obj.t_cholesterol)
$hdl_cholesterol_a.val(obj.hdl_cholesterol)
$sys_bp.val(obj.sys_bp)
for(var i in self.radio_arr){if(self.radio_arr[i].val!=null){$('#'+self.radio_arr[i].id+'_'+self.radio_arr[i].val+'>img').attr('src','images/radio_on'+root.img_str+'.png')}
self.checkHiddenPanels(self.radio_arr[i].id,self.radio_arr[i].val,true)}
setTimeout(function(){self.checkHeight('cm')
self.checkWeight('kg')
self.checkCholesterol('mmol/L')
root.stateObj.clearState()},1000);}
this.calc=function(){if(self.checkDob()){var obj={}
obj.age=Math.floor((now.getTime()-dob.getTime())/31557600000);obj.surv=95-obj.age
obj.town=townsend_score
obj.smoke_cat=parseInt($('#smoke').val());var smoke_str=$('#smoke option:selected').text();var skipped=''
var ch_str=''
obj.ethrisk=parseInt($('#ethnicity').val());obj.bmi=self.bmi()
obj.bmi_rounded=Math.round(self.bmi()*10)/10;for(var i in self.radio_arr){switch(self.radio_arr[i].id){case"cholesterol":var tc=Math.max(0.1,parseFloat($('#t_cholesterol_a').val()))
var th=Math.max(0.1,parseFloat($('#hdl_cholesterol_a').val()))
var mult=1/th
ch_str=Math.round(((tc*mult)*100)/100)+':'+(th*mult)
if(!isNaN(tc)&&!isNaN(th)&&self.radio_arr[i].val=='yes'){obj.rati=tc/th
obj.tc=tc}else{obj.rati=self.defaults.rati
obj.tc=0
skipped+='c'}
break;case"bp":var sbp=parseInt($('#sys_bp').val())
if(!isNaN(sbp)&&self.radio_arr[i].val=='yes'){obj.sbp=sbp}else{obj.sbp=self.defaults.sbp;skipped+='bp'}
break;case"bpt":if(self.radio_arr[i].val=='yes'){obj.b_treatedhyp=true;}else{obj.b_treatedhyp=self.defaults.b_treatedhyp;}
break;case"diabetes":if(self.radio_arr[i].val=='yes'){if($('#diabetes_type').val()=='1'){obj.b_type1=true;obj.b_type2=false;}else{obj.b_type1=false;obj.b_type2=true;}}else{obj.b_type1=self.defaults.b_type1;obj.b_type2=self.defaults.b_type2;}
break;case"arthritis":if(self.radio_arr[i].val=='yes'){obj.b_ra=true;}else{obj.b_ra=self.defaults.b_ra;}
break;case"kidney":if(self.radio_arr[i].val=='yes'){obj.b_renal=true;}else{obj.b_renal=self.defaults.b_renal;}
break;case"af":if(self.radio_arr[i].val=='yes'){obj.b_AF=true;}else{obj.b_AF=self.defaults.b_AF;}
break;case"rcvd":if(self.radio_arr[i].val=='yes'){obj.fh_cvd=true;}else{obj.fh_cvd=self.defaults.fh_cvd;}
break;case"gender":gender=self.radio_arr[i].val;break;}}
root.results.calc(obj,gender,skipped,smoke_str,ch_str)};}
this.validate=function(page){scrollH=1000
var output=true
switch(page){case 1:for(var i=0;i<2;i++){if(this.radio_arr[i].val==null){self.highlightBlock(this.radio_arr[i].id+'_'+this.radio_arr[i].vals[0],'on')
output=false}}
if(this.radio_arr[1].val=='yes'){root.dialog('1C3')
output=false}
break;case 2:if(self.__h>=5&&self.__h<=241){self.highlightBlock('h_cm','off')}else{output=false
self.highlightBlock('h_cm','on')}
if(self.__w>=2&&self.__w<=318){self.highlightBlock('w_kg','off')}else{output=false
self.highlightBlock('w_kg','on')}
break;case 3:for(var i=2;i<5;i++){if(this.radio_arr[i].val==null){self.highlightBlock(this.radio_arr[i].id+'_'+this.radio_arr[i].vals[0],'on')
output=false}}
var rati=self.__t_ch/self.__hdl_ch
if(this.radio_arr[2].val=='yes'&&(self.__t_ch<=0||self.__hdl_ch<=0||rati>12.5||rati<1)){self.highlightBlock('t_cholesterol_a','on')
output=false}else{self.highlightBlock('t_cholesterol_a','off')}
if(this.radio_arr[3].val=='yes'&&isNaN(parseFloat($sys_bp.val()))){self.highlightBlock('sys_bp','on')
output=false}else{self.highlightBlock('sys_bp','off')}
break;case 4:for(var i=5;i<10;i++){if(this.radio_arr[i].val==null){self.highlightBlock(this.radio_arr[i].id+'_'+this.radio_arr[i].vals[0],'on')
output=false}}
break;}
if(!output&&root.qstr.layout=='phone'){window.scroll(0,scrollH)}
return output}
this.getData=function(obj){if(!isNaN(this.__h)){obj.hcm=this.__h}
if(!isNaN(this.__w)){obj.wkg=this.__w}
if(this.__hdl_ch>0){obj.chs=$hdl_cholesterol_a.val()}
if(this.__t_ch>0){obj.cht=$t_cholesterol_a.val()}
return obj}
this.highlightBlock=function(id,val){var $tmp=$('#'+id).parent().parent().parent()
if(val=='on'){scrollH=Math.min($tmp.position().top,scrollH)
$tmp.css('background-color','#fad2d4')}else{$tmp.css('background-color','#ededed')}}
this.clear=function(){}
this.initRadio();this.dobComboSet(true,null)
this.checkHeight('cm')
this.checkWeight('kg')
this.checkCholesterol('mmol/L')}

function index(){var self=this
self.page=0
self.analytics_page=0
self.$nav=$('#nav')
self.$dots=$('#dots')
self.$header=$('#header')
self.$mob_header=$('#mob_header')
self.responsive=false
self.w='600px'
var $next=$('#next')
var $reset=$('#reset')
var $back=$('#back')
var $more_info_content=$('#more_info_content')
var json_url='heartage.js'
var transition=false
var redirect_str='/tools/documents/heartage/index.html';self.speed=600
self.retina=window.devicePixelRatio>1;self.asset_dir='assets/'
self.text_data=null
var $main=$('#main')
var $dialog_outer=$('#dialog_outer')
var $dialog_inner=$('#dialog_inner')
var $dialog_content=$('#dialog_content')
var $result_loader=$('#result_loader')
var locked=false
self.device='desktop'
self.layout='desktop'
self.qstr=getUrlVars();self.img_str=''
var $pages=new Array($('#page_0'),$('#page_1'),$('#page_2'),$('#page_3'),$('#page_4'),$('#page_5'))
$('#page_loader>div').css('background-color','#e81e26')
if(self.qstr.hasOwnProperty('syn_id')){self.syn_id=self.qstr.syn_id
self.syndicate=true
redirect_str='//https://media.nhschoices.nhs.uk/tools/documents/heartage/index.html';$('#splash_main>h1').before('<a href="//www.nhs.uk/Tools/Pages/heartage.aspx" target = "_new" id="syn_header"><img src = "images/choices-logo@2x.png" height="50" width="222" border="0"></a>')}else{self.syn_id='nhs'
self.syndicate=false}
if(isMobile.any()){self.device='phone'}
if(self.qstr.layout=='phone'){self.$dots.remove()
self.layout='phone'
loadjscssfile('css/healthcheck_mob.css','css')}
if(self.qstr.layout=='phone'||self.device=='tablet'){document.getElementById('h_cm').type='number'
document.getElementById('h_ft').type='number'
document.getElementById('h_in').type='number'
document.getElementById('w_kg').type='number'
document.getElementById('w_st').type='number'
document.getElementById('w_lb').type='number'
document.getElementById('t_cholesterol_a').type='number'
document.getElementById('t_cholesterol_b').type='number'
document.getElementById('hdl_cholesterol_a').type='number'
document.getElementById('hdl_cholesterol_b').type='number'
document.getElementById('sys_bp').type='number'
if(isMobile.iOS()){loadjscssfile('css/healthcheck_ios.css','css')}}
if(self.retina||self.qstr.layout=='phone'){var $imgs=$('img')
for(var i=0;i<$imgs.length;i++){if($imgs[i].src.indexOf('@2x')==-1){$imgs[i].src=$imgs[i].src.replace('.png','@2x.png')}}
this.img_str='@2x'}
loadjscssfile('js/z_lookupData.js','js')
this.setResponsive=function(){self.responsive=true
self.w='100%'
loadjscssfile('css/healthcheck_responsive.css','css');var msg='<div id="more_close"><a href="javascript:;" class="close"><img src="images/close2.png" alt="close" width="17" height="17" /></a></div><p><img src="images/public-health@2x.png" width="150px" height="94"></p>'
msg+='<div class="p_hr">'+self.text_data.TextAreas.credit+'</div>'
msg+='<div class="p_hr">'+self.text_data.PopupText.P1.replace('<br><br>','').replace('<img','<img style="margin-left:-22px" ')+'</div>'
msg+='<div class="p_hr">'+self.text_data.PopupText.P2+'</div>'
$more_info_content.html(msg)
if(self.syndicate){$('#splash_main').css('background-image','url(images/syn_logo@2x.png)')
$('#splash_main').css('background-size','186px 38px')
$('#splash_main').css('background-position','center 25px')}
window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "'+$('#page_0').height()+'px"}','*');$('#more_close>a').on('click',function(){$main.fadeIn(self.speed)
$more_info_content.fadeOut(self.speed,function(){window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "'+$('#page_0').height()+'px"}','*');})})
$('#more_info a').on('click',function(){$more_info_content.fadeIn(self.speed)
$main.fadeOut(self.speed)
window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "'+($more_info_content.height()+30)+'px","scrolltop":true}','*');});}
this.getConfig=function(data){$.getJSON(json_url,function(data){self.stateObj=new maintain_state(self);self.analyticsObj=new analytics(self,{'id':'NHS-HC-heartage','title':'Check your heart age','category':'Self assessments'},self.syn_id);self.form=new form(self);self.results=new results(self);self.populateText(data)
$('#page_loader').fadeOut(500,function(){$('#page_loader').remove()});})}
this.dialog=function(key){if(!locked){$dialog_content.css('height','auto')
if(typeof(key)=='string'){var str=self.text_data.PopupText[key]}else{var str='';for(var i=0;i<key.length;i++){if(i==key.length-1){str+='<div class="p_hr" style = "border:none;">'}else{str+='<div class="p_hr">'}
str+=self.text_data.PopupText[key[i]]
str+='</div>'}}
if(str.length<500){$dialog_inner.width('70%').css('margin-left','-38%')}else{$dialog_inner.width('80%').css('margin-left','-43%')}
str=str.replace('.png',self.img_str+'.png')
self.lockView()
$dialog_outer.fadeTo(self.speed,0.6)
$dialog_inner.fadeIn(self.speed)
$dialog_content.html(str)
setTimeout(function(){var h=$pages[self.page].height()
if($dialog_content.height()>$(window).height()*0.85){$dialog_content.css('overflow-y','scroll').height($(window).height()*0.85).css('margin-top','10px')}
var ih=Math.min($dialog_content.height(),$pages[self.page].height()+60)
if(self.page==0){ih+=80}
if(self.qstr.layout=='phone'){$dialog_inner.css('top','20px')}else{$dialog_inner.css('top',Math.max(10,((h-ih)/2))+'px')}},0)}}
this.dialogClose=function(key){self.unlockView()
$dialog_outer.fadeOut(self.speed/2)
$dialog_inner.fadeOut(self.speed/2,function(){$dialog_content.css('overflow-y','auto').height(null).css('margin-top','0px')})}
this.lockView=function(){$main.find("a").attr("tabindex",-1);$main.find("input").attr("tabindex",-1);$main.find("select").attr("tabindex",-1);}
this.unlockView=function(){$main.find("a").attr("tabindex",null);$main.find("input").attr("tabindex",null);$main.find("select").attr("tabindex",null);}
this.populateText=function(data){self.text_data=data
$('#splash_copy').html('<p>'+data.TextAreas.splash+'</p>')
$('#splash_footer').html('<img src="images/partner_logos'+self.img_str+'.png" width="335px" height="87px"><div>'+data.TextAreas.credit+'<div id = "partner_info"><a href = "javascript:;" id="p_info">More information about partners</a><br>Full <a href = "javascript:;" id="credits" >credits</a> can be read here</div></div>')
$('#bp_data_alt').html(data.PopupText['3C2b'])
$('#cholesterol_data_alt').html(data.PopupText['3C1b'])
if(self.device=='desktop'||self.qstr.layout=='phone'){self.init()}else{window.parent.postMessage('{"antbits_check_responsive": "true"}','*')}}
this.paginate=function(){for(var $p=0;$p<$pages.length;$p++){if($p==self.page){$pages[$p].show()}else{$pages[$p].hide()}}
$back.on('click',function(e){setTimeout(function(){e.target.parentNode.blur()},100)
if(!transition){self.changePage(self.page-1,false)}})
$next.on('click',function(e){setTimeout(function(){e.target.parentNode.blur()},100)
if(!transition){if(self.form.validate(self.page)){self.changePage(self.page+1,false)}}})
$reset.on('click',function(e){setTimeout(function(){e.target.parentNode.blur()},100)
self.resetAll()})}
this.resetAll=function(){self.stateObj.clearState()
$main.fadeOut('spd',function(){if(self.qstr.layout!='phone'&&!self.syndicate){window.parent.scrollTo(0,0);}
location.reload();})}
this.changePage=function(target,snap){var spd=self.speed
var d=self.page-target
if(snap){spd=0}
$('#page_'+self.page).fadeOut(spd)
if(self.page==5&&target==4){self.results.tidyUp()}
transition=true
self.page=target
self.analytics_page=Math.max(self.analytics_page,self.page)
if(self.page==1){self.$header.delay(spd).fadeIn(spd)
if(d<0){self.analyticsObj.start()
setTimeout(function(){self.navFadeIn(spd)},spd);}else{self.$nav.fadeOut(spd,function(e){self.navFadeIn(spd)})}
self.$dots.delay(spd).fadeIn(spd)
$('#page_'+self.page).delay(spd).fadeIn(spd,function(){transition=false})}else if(self.page>1&&self.page<5){if(d<0){self.analyticsObj.advance(self.page,5)}
self.$header.delay(spd).fadeIn(spd);self.$nav.fadeOut(spd,function(e){self.navFadeIn(spd);})
self.$dots.delay(spd).fadeIn(spd,function(){transition=false});$('#page_'+self.page).delay(spd).fadeIn(spd)}else if(self.page==5){if(d<0){self.analyticsObj.advance(self.page,5)}
self.$header.fadeOut(spd)
self.$dots.fadeOut(spd)
self.$nav.fadeOut(spd)
$('#result_loader>div').css('background-color','#e81e26')
$result_loader.delay(spd).fadeIn(spd,function(){window.scrollTo(0,0);self.form.calc()}).delay(spd*5).fadeOut(spd,function(){transition=false})
setTimeout(function(){$('#page_'+self.page).fadeIn(spd)
self.navFadeIn(spd)
$next.hide()
$reset.show()},spd*7)}else{self.$nav.fadeOut(spd)
self.$header.fadeOut(spd)
$('#page_'+self.page).delay(spd).fadeIn(spd,function(){transition=false})}
if(self.qstr.layout=='phone'&&self.page<=1){$back.fadeOut(spd)}else{$back.delay(spd).fadeIn(spd);}
if(!snap){self.form.storeState()}
if(self.page<=4){setTimeout(function(){window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "700px"}','*');},spd)}
if(self.tabbing){switch(self.page){case 0:$('#start').focus();break;case 1:$('#dob_day').focus();break;case 2:$('#smoke').focus();break;case 3:$('#cholesterol_yes').focus();break;case 4:$('#diabetes_yes').focus();break;}}
self.setPhoneHeight();}
this.setPhoneHeight=function(){var target=$('#page_'+self.page)
$('#shim').height(target.height()+100)}
this.trackHeight=function(){var t=0
var target=$('#page_'+self.page)
var duration=(self.speed/2)
if(self.page==5){duration=(self.speed*2)}
var tracker=setInterval(function(){if(self.qstr.layout!='phone'){window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "'+(target.height()+100)+'px"}','*');}else{}
t+=(self.speed/50)
if(t>=duration){clearInterval(tracker)}
if(self.page==5){if(self.qstr.layout=='phone'){self.$nav.css('top',target.height()+50)}else{self.$nav.css('top',target.height())}}},10)}
this.navFadeIn=function(spd){$next.show()
$reset.hide()
self.$nav.fadeIn(spd)
if(self.page<5){self.$nav.css('top',($('#page_'+self.page).height()+100))}
for(var i=1;i<5;i++){if(i<=self.page){$('#d'+i).attr('src','images/d_dn'+self.img_str+'.png')}else{$('#d'+i).attr('src','images/d_up'+self.img_str+'.png')}}
if(self.qstr.layout=='phone'){window.scrollTo(0,0);if(self.page==5){self.$mob_header.show()}else{self.$mob_header.hide()}}}
this.restoreState=function(obj){if(!self.responsive){self.form.restoreState(obj)
if(obj.page==5){self.results.counter_delay=0}
self.changePage(obj.page,true)}}
this.redirect=function(url){window.parent.postMessage('{"antbits_redirect": "'+url+'"}','*');}
$(window).on('message',function(e){var tmp=(eval('('+e.originalEvent.data+')'));if(tmp.hasOwnProperty('antbits_set_responsive')){if(tmp.antbits_set_responsive=='mobile'||tmp.antbits_set_responsive=='micro'||(self.syn_id=='bhf'&&self.device=='phone')){self.setResponsive();$('#syn_header').remove()}
self.init();}})
if(self.qstr.layout!='phone'){$(window).mousedown(function(e){self.tabbing=false})
$(window).keydown(function(e){if(e.keyCode==9||e.keyCode==13){self.tabbing=true}})}
$(window).on('resize',function(e){if(self.qstr.layout=='phone'){if(self.page==5){self.$nav.css('top',($('#page_'+self.page).height()+50))}else{self.$nav.css('top',($('#page_'+self.page).height()+100))}}
self.results.resizeLayout()})
this.init=function(){$main.show()
if(self.responsive){self.w='100%'
window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "'+($('#page_0').height()+30)+'px"}','*');}else{window.parent.postMessage('{"antbits_w": "'+self.w+'","antbits_h": "700px"}','*');}
self.$nav.fadeOut(0)
$('#start').on('click',function(){if(self.device!='phone'){self.changePage(1,false);}else{self.redirect(redirect_str+'?layout=phone')}})
$('#dialog_close >a').on('click',function(){self.dialogClose()})
$('#p_info').on('click',function(){self.dialog(['P1','P2','P3'])})
$('#credits').on('click',function(){self.dialog('P4')})
$dialog_outer.on('click',function(){self.dialogClose()})
self.paginate()
if(self.qstr.layout=='phone'){$('#page_5>h2:first').remove()
document.addEventListener("touchstart",function(){},true);self.changePage(1,true);self.stateObj.restoreState();$('.form_btn').on('click',function(e){e.target.style.backgroundColor='#136ab9'
setTimeout(function(){e.target.style.backgroundColor='#1885e7'},300)})
$('#back').on('click',function(e){e.target.style.backgroundColor='#8e8e8e'
setTimeout(function(){e.target.style.backgroundColor='#999999'},300)})}else{self.stateObj.restoreState();}
self.setPhoneHeight();}}

(function($,document,undefined){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=config.json?JSON.stringify(value):String(value);return(document.cookie=[encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var decode=config.raw?raw:decoded;var cookies=document.cookie.split('; ');for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');if(decode(parts.shift())===key){var cookie=decode(parts.join('='));return config.json?JSON.parse(cookie):cookie;}}
return null;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true;}
return false;};})(jQuery,document);

function maintain_state(r){var self=this
var init=false
var root=r
self.visits=0
self.data={}
this.storeState=function(obj){self.data=obj
if(init){obj.visits=self.visits
$.cookie("nhs_heartage",JSON.stringify(obj));}}
this.clearState=function(){$.removeCookie("nhs_heartage");var obj={'visits':self.visits}
$.cookie("nhs_heartage",JSON.stringify(obj));init=true}
this.restoreState=function(){if($.cookie("nhs_heartage")!=null){self.data=jQuery.parseJSON($.cookie("nhs_heartage"));if(!isNaN(parseInt(self.data.visits))){self.visits=parseInt(self.data.visits)+1}
if(parseInt(self.data.page)>0){root.restoreState(self.data)}}
self.clearState();}
this.getData=function(obj){var bool_obj={'yes':1,'no':0}
obj.v=self.visits
obj.p=root.analytics_page
inObj(obj,'smk',self.data.smoke)
inObj(obj,'eth',self.data.ethnicity)
if(typeof self.data.dob!='undefined'){obj.age=Math.floor((new Date()-new Date(self.data.dob))/31557600000)}
inObj(obj,'bmi',self.data.bmi)
if(!isNaN(obj.bmi)){obj.bmi=obj.bmi.toFixed(2)}
if(self.data.postcode=="e.g CB10 2PS"||self.data.postcode==""){obj.pc=0}else{obj.pc=1}
inObj(obj,'tn',self.data.townsend_score)
inObj(obj,'r',self.data.region)
for(var key in self.data.radio_arr){switch(self.data.radio_arr[key].id){case'cholesterol':if(self.data.radio_arr[key].val=='no'||isNaN(parseFloat(self.data.t_cholesterol))||isNaN(parseFloat(self.data.hdl_cholesterol))){obj.ch=0}else{obj.ch=(parseFloat(self.data.t_cholesterol)/parseFloat(self.data.hdl_cholesterol)).toFixed(2)}
break;case'bp':if(self.data.radio_arr[key].val=='no'||isNaN(parseInt(self.data.sys_bp))){obj.sbp=0}else{obj.sbp=parseInt(self.data.sys_bp)}
break;case'gender':if(self.data.radio_arr[key].val!=null){obj[self.data.radio_arr[key].id.slice(0,3)]=self.data.radio_arr[key].val}
break;default:if(self.data.radio_arr[key].val!=null){obj[self.data.radio_arr[key].id.slice(0,3)]=bool_obj[self.data.radio_arr[key].val]}
break;}}
return obj}}

function Q65_lifetime(){var self=this
var then=new Date()
var genders=Array('female','male')
var a_cvd_obj_0=new Q65_female_cvd();var a_cvd_obj_1=new Q65_male_cvd();var a_death_obj_0=new Q65_female_death();var a_death_obj_1=new Q65_male_death();var compare_period=10
var centerings=[{bmi:10*1.605074524879456*1.605074524879456,rati:3.5,sbp:120,town:-0.301369071006775},{bmi:10*Math.exp(0.967572152614594),rati:3.5,sbp:120,town:-0.164980158209801}]
this.lookup=new lookupData();this.find_biggest_t_below_number_in_array=function(number,array,arrayNumberOfRows){var i;var found=0;if(array._t[0]>=number){return-2;}
for(i=0;i<arrayNumberOfRows;i++){if(array._t[i]>=number){found=1;break;}}
if(found){i--;}else{i=-1;}
return(i);}
this.produceLifetimeRiskTable=function(timeTable,from,to,a_cvd,a_death,sex,followupYear){var resultArray=new Array();var annualRiskTable=new Array();var annualRiskTable_int=new Array();var sage=30;var lage=95;var timeTableIndex=from;var exp_a_cvd=Math.exp(a_cvd);var exp_a_death=Math.exp(a_death);var t0=Math.round(timeTable[timeTableIndex][0])
var lastRow
var newRow
var lastRow_int
var newRow_int
var nYearRisk=0;var t=t0-1;var sum_e_int=0
for(var i=0;i<=(timeTable.length-from-2);i++){var baseHazard={"death":timeTable[timeTableIndex][1]*exp_a_death,"cvd":timeTable[timeTableIndex][2]*exp_a_cvd};var baseHazard_int={"death":timeTable[timeTableIndex][1]*exp_a_death,"cvd":timeTable[timeTableIndex][2]*exp_a_cvd};if(i==0){lastRow=new LifetimeRiskRow(1-baseHazard.cvd-baseHazard.death,baseHazard.cvd,baseHazard.death,1-baseHazard.cvd,baseHazard.cvd);lastRow_int=new LifetimeRiskRow(1-baseHazard_int.cvd-baseHazard_int.death,baseHazard_int.cvd,baseHazard_int.death,1-baseHazard_int.cvd,baseHazard_int.cvd);}
else{newRow=new LifetimeRiskRow(lastRow.S_1*(1-baseHazard.cvd-baseHazard.death),lastRow.cif_cvd+lastRow.S_1*baseHazard.cvd,lastRow.cif_death+lastRow.S_1*baseHazard.death,lastRow.S_noDeath*(1-baseHazard.cvd),lastRow.cvd_noDeath+lastRow.S_noDeath*baseHazard.cvd);newRow_int=new LifetimeRiskRow(lastRow_int.S_1*(1-baseHazard_int.cvd-baseHazard_int.death),lastRow_int.cif_cvd+lastRow_int.S_1*baseHazard_int.cvd,lastRow_int.cif_death+lastRow_int.S_1*baseHazard_int.death,lastRow_int.S_noDeath*(1-baseHazard_int.cvd),lastRow_int.cvd_noDeath+lastRow_int.S_noDeath*baseHazard_int.cvd);lastRow=newRow;lastRow_int=newRow_int;}
t1=Math.floor(timeTable[timeTableIndex][0])
if(t1>t){t=t1;annualRiskTable.push(lastRow);annualRiskTable_int.push(lastRow_int);}
if(t>=followupYear-1){nYearRisk=lastRow.cif_cvd;}
timeTableIndex++;}
annualRiskTable.push(lastRow);annualRiskTable_int.push(lastRow_int);for(i=0;i<annualRiskTable.length;i++){sum_e_int+=100*annualRiskTable[i].S_1;}
return{"life":(sum_e_int/100),"annualRiskTable_int":annualRiskTable_int,"annualRiskTable":annualRiskTable,"nYearRisk":nYearRisk,"hazard":self.getNoDeathHazardAt(annualRiskTable,0)}}
this.produceLifetimeRiskTable_int=function(timeTable,from,to,a_cvd,a_death,sex,followupYear)
{var timeTableIndex=from;var timeTableIndex_int=from;var t0=parseInt(timeTable[timeTableIndex][0]);var t0_int=parseInt(timeTable[timeTableIndex][0]);var annualRiskTable=new Array();var annualRiskTable_int=new Array();var lastRow,lastRow_int,newRow,newRow_int;var nYearRisk=0;var exp_a_cvd=Math.exp(a_cvd);var exp_a_death=Math.exp(a_death);var t=t0-1;var f=from
for(i=f-from;i<(timeTable.length-from-2);f++,i++){var baseHazard={"death":timeTable[timeTableIndex][1]*exp_a_death,"cvd":timeTable[timeTableIndex][2]*exp_a_cvd};var baseHazard_int={"death":timeTable[timeTableIndex][1]*exp_a_death,"cvd":timeTable[timeTableIndex][2]*exp_a_cvd};if(i==0){lastRow=new LifetimeRiskRow(1-baseHazard.cvd-baseHazard.death,baseHazard.cvd,baseHazard.death,1-baseHazard.cvd,baseHazard.cvd);lastRow_int=new LifetimeRiskRow(1-baseHazard_int.cvd-baseHazard_int.death,baseHazard_int.cvd,baseHazard_int.death,1-baseHazard_int.cvd,baseHazard_int.cvd);}
else{newRow=new LifetimeRiskRow(lastRow.S_1*(1-baseHazard.cvd-baseHazard.death),lastRow.cif_cvd+lastRow.S_1*baseHazard.cvd,lastRow.cif_death+lastRow.S_1*baseHazard.death,lastRow.S_noDeath*(1-baseHazard.cvd),lastRow.cvd_noDeath+lastRow.S_noDeath*baseHazard.cvd);newRow_int=new LifetimeRiskRow(lastRow_int.S_1*(1-baseHazard_int.cvd-baseHazard_int.death),lastRow_int.cif_cvd+lastRow_int.S_1*baseHazard_int.cvd,lastRow_int.cif_death+lastRow_int.S_1*baseHazard_int.death,lastRow_int.S_noDeath*(1-baseHazard_int.cvd),lastRow_int.cvd_noDeath+lastRow_int.S_noDeath*baseHazard_int.cvd);lastRow=newRow;lastRow_int=newRow_int;}
t1=Math.floor(timeTable[timeTableIndex][0])
if(t1>t){t=t1;annualRiskTable.push(lastRow);annualRiskTable_int.push(lastRow_int);}
if(t>=followupYear-1){nYearRisk=lastRow.cif_cvd;}
timeTableIndex++;}
annualRiskTable.push(lastRow);annualRiskTable_int.push(lastRow_int);return{"annualRiskTable_int":annualRiskTable_int,"annualRiskTable":annualRiskTable,"nYearRisk":nYearRisk,"hazard":self.getNoDeathHazardAt(annualRiskTable,0)}}
this.getNoDeathHazardAt=function(rows,index){index=Math.min(index,rows.length-2)
if(index<0){return 0}else{return(rows[index+1].cvd_noDeath-rows[index].cvd_noDeath)/rows[index].S_noDeath;}}
this.lifetimeRisk=function(cage,sex,noOfFollowupYears,form_data){var startRow,baseArray,finishRow,resultArraySize,lifetimeRisk,followupIndex,nYearRisk,followupRow,a_cvd,a_death,timeTable,arrayNumberOfRows,resultArray,last,base_data,life
function setParams(){if(sex==0){a_cvd=a_cvd_obj_0.cvd(form_data)
a_death=a_death_obj_0.death(form_data)
timeTableRaw=self.lookup.female;arrayNumberOfRows=self.lookup.female._t.length}
else{a_cvd=a_cvd_obj_1.cvd(form_data)
a_death=a_death_obj_1.death(form_data)
timeTableRaw=self.lookup.male;arrayNumberOfRows=self.lookup.male._t.length}}
setParams();var possibly_younger=false
var sage=30;var lage=95;var heartage=cage-1
var baseResult,baseResult_int,userResult,userResult_int
var timeTable=new Array()
for(var i=0;i<=timeTableRaw._t.length;i++){timeTable.push([timeTableRaw._t[i],timeTableRaw.basehaz_death_0_30[i],timeTableRaw.basehaz_cvd_0_30[i]])}
startRow=Math.max(0,self.find_biggest_t_below_number_in_array(cage-sage,timeTableRaw,arrayNumberOfRows)+1);finishRow=arrayNumberOfRows-1;resultArraySize=finishRow-startRow;userResult=self.produceLifetimeRiskTable(timeTable,startRow,finishRow,a_cvd,a_death,sex,lage-sage);life=(cage+userResult.life)
userResult_int=self.produceLifetimeRiskTable_int(timeTable,startRow,finishRow,a_cvd,a_death,sex,lage-sage);followupIndex=cage-sage+noOfFollowupYears;base_data={}
base_data.town=centerings[sex].town
base_data.bmi=centerings[sex].bmi
base_data.sbp=centerings[sex].sbp
base_data.rati=centerings[sex].rati
base_data.ethrisk=form_data.ethrisk
base_data.b_type1=false
base_data.b_type2=false
base_data.b_AF=false
base_data.b_ra=false
base_data.b_renal=false
base_data.b_treatedhyp=false
base_data.fh_cvd=false
base_data.smoke_cat=0
base_data.surv=noOfFollowupYears
if(sex==0){a_cvd=a_cvd_obj_0.cvd(base_data)
a_death=a_death_obj_0.death(base_data)}else{a_cvd=a_cvd_obj_1.cvd(base_data)
a_death=a_death_obj_1.death(base_data)}
baseResult=self.produceLifetimeRiskTable(timeTable,startRow,finishRow,a_cvd,a_death,sex,lage-sage);for(var i in baseResult.annualRiskTable_int){if(self.getNoDeathHazardAt(baseResult.annualRiskTable_int,i)>userResult.hazard){if(i==0){possibly_younger=true;}
break;}}
if(possibly_younger){var d_gp=self.getNoDeathHazardAt(baseResult.annualRiskTable_int,1)-self.getNoDeathHazardAt(baseResult.annualRiskTable_int,0);var gpHazard=self.getNoDeathHazardAt(baseResult.annualRiskTable_int,0)
while((i>-5)&&(gpHazard-=d_gp)>userResult.hazard){i--;}}else{var myHazard=userResult_int.hazard;var h_i=self.getNoDeathHazardAt(baseResult.annualRiskTable_int,i);var h_i_1=self.getNoDeathHazardAt(baseResult.annualRiskTable_int,i-1);if(h_i!=h_i_1){i-=(h_i-myHazard)/(h_i-h_i_1);}}
heartage=Math.min(95,Math.round(parseFloat(cage)+parseFloat(i)))
var compare_index=Math.min(compare_period,userResult.annualRiskTable_int.length-1)
return{'life':life,'heartage':heartage,'risk':userResult.hazard,'10_yr_risk':Math.round((userResult.annualRiskTable_int[compare_index].cvd_noDeath)*1000)/10};}}

function Q65_female_cvd(){var self=this
this.cvd=function(form_data){for(var i in form_data){eval('var '+i+' = '+form_data[i])}
var a;var Iethrisk=new Array(0,0,0.3519781359171325100000000,0.7125701233074622800000000,0.4744736904914790800000000,0.1277734031153024400000000,0.0276815264451465880000000,-0.3676643548251001300000000,-0.2636321488403285400000000,-0.0064333267101571784000000);var Ismoke=new Array(0,0.1609363217948046300000000,0.3282477751045009300000000,0.4541679502935254700000000,0.6076275665698729300000000);a=0;a+=Iethrisk[ethrisk];a+=Ismoke[smoke_cat];a+=(Math.sqrt(bmi/10)-1.605074524879456)*0.2813726290228962300000000;a+=(rati-3.705839872360230)*0.1551217926855477100000000;a+=(sbp-129.823593139648440)*0.0062458135965802464000000;a+=(town+0.301369071006775)*0.0239763590547845720000000;a+=b_AF*0.6363540037072725800000000;a+=b_ra*0.3607328778130438100000000;a+=b_renal*0.5144859684018359100000000;a+=b_treatedhyp*0.2825312388249602800000000;a+=b_type2*0.5114309272510256800000000;a+=fh_cvd*0.5135507323965317100000000;return a;}}

function Q65_male_cvd(){var self=this
this.cvd=function(form_data){for(var i in form_data){eval('var '+i+' = '+form_data[i])}
var a;var bmi_1;var Iethrisk=new Array(0,0,0.4035656542786645300000000,0.7159343574607238700000000,0.7588068966921870400000000,0.2778257996405138500000000,-0.3383277413537653700000000,-0.3626891973109574500000000,-0.2406220118164148500000000,-0.1055741084408314400000000);var Ismoke=new Array(0,0.1655389770495527800000000,0.3227167436634277900000000,0.4393091679622852500000000,0.5830168090609184600000000);a=0;a+=Iethrisk[ethrisk];a+=Ismoke[smoke_cat];a+=(Math.log(bmi/10)-0.967572152614594)*0.4325953310683352500000000;a+=(rati-4.439734935760498)*0.1616093175199347100000000;a+=(sbp-133.265686035156250)*0.0051706475575211365000000;a+=(town+0.164980158209801)*0.0118372789415412600000000;a+=b_AF*0.4871573476846625100000000;a+=b_ra*0.3165460738113234400000000;a+=b_renal*0.4665323499934942400000000;a+=b_treatedhyp*0.3146452536778831000000000;a+=b_type2*0.4700445024972483300000000;a+=fh_cvd*0.6101222792348441900000000;return a;}}

function Q65_female_death(){var self=this
this.death=function(form_data){for(var i in form_data){eval('var '+i+' = '+form_data[i])}
var a;var bmi_1;var Iethrisk=new Array(0,0,-0.7691412217114335100000000,-0.4813884489809012200000000,-0.6649693187337454300000000,-0.9806514018090445300000000,-0.7665687475367323200000000,-0.3079908452168220200000000,-1.1084520766868413000000000,-0.9729355194482460800000000);var Ismoke=new Array(0,0.2343310901409800500000000,0.5870690502658261200000000,0.7964460203072020200000000,1.0533145224303277000000000);var dbmi=bmi;dbmi=dbmi/10;bmi_1=Math.pow(dbmi,.5);a=0;a+=Iethrisk[ethrisk];a+=Ismoke[smoke_cat];a+=(Math.sqrt(bmi/10)-1.605074524879456)*-0.1081416642130314200000000;a+=(rati-3.705839872360230)*0.0273178320909109660000000;a+=(sbp-129.823593139648440)*-0.0008337937584279265700000;a+=(town+0.301369071006775)*0.0366304184773099120000000;a+=b_AF*0.5484061247122409300000000;a+=b_ra*0.4667078978482423500000000;a+=b_renal*1.0288138959180866000000000;a+=b_treatedhyp*-0.0500562994738190240000000;a+=b_type2*0.6543819525425483800000000;a+=fh_cvd*-0.4629154246984292800000000;return a;}}

function Q65_male_death(){var self=this
this.death=function(form_data){for(var i in form_data){eval('var '+i+' = '+form_data[i])}
var a;var Iethrisk=new Array(0,0,-0.7959493840935216700000000,-0.8983542916653508600000000,-0.8464836394282484500000000,-1.3907364202494530000000000,-0.7939585494106227200000000,-0.6696772151327180500000000,-1.3074649266863319000000000,-1.0983395480170892000000000);var Ismoke=new Array(0,0.2306667408386281800000000,0.5716670855343914900000000,0.7849316319893276900000000,1.0119244230108204000000000);a=0;a+=Iethrisk[ethrisk];a+=Ismoke[smoke_cat];a+=(Math.log(bmi/10)-0.967572152614594)*-0.4077463700204617700000000;a+=(rati-4.439734935760498)*-0.0137508433127115260000000;a+=(sbp-133.265686035156250)*0.0005828619709622257200000;a+=(town+0.164980158209801)*0.0509394028862269410000000;a+=b_AF*0.4141766179931511400000000;a+=b_ra*0.4757132805164633300000000;a+=b_renal*0.8498597130356305700000000;a+=b_treatedhyp*0.0722059208073983630000000;a+=b_type2*0.4918060293979553700000000;a+=fh_cvd*-0.3664212379436541700000000;return a;}}

function results(r){var root=r
var self=this;var rs=null
var ch_rs_low={'heartage':95}
var ch_rs_high={'heartage':0}
var bp_rs_low={'heartage':95}
var bp_rs_high={'heartage':0}
var eth_alt=[2,3,4,5,8]
var heart_age_low=100
var heart_age_high=0
var brackets={'cholesterol':[1,8],'bp':[90,140]}
this.qriskLT=new Q65_lifetime();this.counter_delay=root.speed*5.5
self.data={'more':0,'exit':0,'links':[]}
var risk='low'
var $r1_content=$('#r1_content')
var $r1_title=$('#r1_title')
var $r1_heart_age=$('#r1_heart_age')
var $r2_content=$('#r2_content')
var shared={"fb":0,"tw":0,"gp":0,"em":0}
var advice_obj=[{'title':'Smoking','result_key':'Smoking','advice_status':'[qval]','text':'','key':null,'qval':'smoke_str','val':'obj.smoke_cat','info':false},{'title':'Blood pressure','result_key':'BloodPressure','advice_status':'[qval]<div>[risk]</div>','text':'','key':'bp','qval':'obj.sbp','val':'obj.sbp','info':false},{'title':'Cholesterol','result_key':'Cholesterol','advice_status':'Ratio [qval]<div>[risk]</div>','text':'','key':'c','qval':'ch_str','val':'obj.rati','info':false},{'title':'Weight','result_key':'Weight','advice_status':'BMI [qval]<div>[risk]</div>','risk':0,'text':'','key':null,'qval':'obj.bmi_rounded','val':'obj.bmi','info':false}]
var $advice_wrap=$('#advice_wrap')
this.logLink=function(evt){var t=''
if(evt.target.nodeName=='IMG'){t=evt.target.parentNode.href}else{t=evt.target.href}
var mapObj={'https://':'','http://':'','www.':'','nhs.uk':''};self.data.links.push(replaceAll(t,mapObj))
self.data.links=arrayUnique(self.data.links)
self.data.exit=1}
this.resizeLayout=function(){if(root.page==5){var side_scroll='scroll'
if(root.qstr.layout=='phone'){var pad=2;var i_w=177
var p_w=$('#page_5').width()-40
if(p_w>=(i_w*3)){pad=(p_w-(i_w*3))/2
side_scroll='hidden'}else{side_scroll='scroll'
if((i_w*2)<p_w+20&&(i_w*2)>p_w-20){pad=i_w/3}}
for(var i=0;i<advice_obj.length;i++){$('#infoDD_'+i).css('overflow-x',side_scroll)
$('#infoDD_'+i+'>:first-child').css('margin','0px '+pad+'px 0px 0px')
$('#infoDD_'+i+'>:last-child').css('margin','0px 0px 0px '+pad+'px')}}else{$('#page_5 .info_item').css('margin','0px 1px 0px 1px')}}}
this.calc=function(obj,gender,skipped,smoke_str,ch_str){$r1_heart_age.html(0)
ch_rs_low={'heartage':95}
ch_rs_high={'heartage':0}
bp_rs_low={'heartage':95}
bp_rs_high={'heartage':0}
delete this.qriskLT
this.qriskLT=new Q65_lifetime();rs=self.qriskLT.lifetimeRisk(obj.age,gender,10,obj);$r1_title.html('Your heart age is about')
$r1_content.html(root.text_data.TextAreas.r1_content)
var msg='<p>'+root.text_data.TextAreas.life+'</p>'
msg+='<div id = "life_bar"><div id = "life_bar_fill"><img src= "images/e81e26.png" alt="'+Math.floor(rs['life'])+' years life average expectancy"></div><div id = "life_bar_scale"><div id = "lf_40">40</div><div id = "lf_50">50</div><div id = "lf_60">60</div><div id = "lf_70">70</div><div id = "lf_80">80</div><div id = "lf_90">90</div><div id = "lf_100">100</div></div></div>'
msg+=root.text_data.TextAreas.r2_content
msg=msg.replace('[10_yr_risk]','<span class="emphasis">'+rs['10_yr_risk']+'%</span>').replace('[life]','<span class="emphasis">'+Math.floor(rs['life'])+'</span>')
if(rs['10_yr_risk']<10){risk='low'}else if(rs['10_yr_risk']<20){risk='moderate'}else{risk='high'}
msg=msg.replace('[risk]',risk)
$r2_content.html(msg)

if(root.qstr.layout=='phone'){msg='<div><img src = "images/heart.mob@2x.png" width = "40" alt="heart icon" height  = "53"></div>'}else{msg='<div><img src = "images/heart@2x.png" width = "76" alt="heart icon" height  = "68"></div>'}
if(skipped!=''){var ch_init=obj.rati
if(skipped.indexOf('c')>-1){obj.rati=brackets.cholesterol[0]
ch_rs_low=self.qriskLT.lifetimeRisk(obj.age,gender,10,obj);obj.rati=brackets.cholesterol[1]
ch_rs_high=self.qriskLT.lifetimeRisk(obj.age,gender,10,obj);obj.rati=ch_init}
var bp_init=obj.sbp
if(skipped.indexOf('bp')>-1){obj.sbp=brackets.bp[0]
bp_rs_low=self.qriskLT.lifetimeRisk(obj.age,gender,10,obj);obj.sbp=brackets.bp[1]
bp_rs_high=self.qriskLT.lifetimeRisk(obj.age,gender,10,obj);obj.sbp=bp_init}
heart_age_low=Math.min(bp_rs_low.heartage,ch_rs_low.heartage,rs.heartage)
heart_age_high=Math.max(bp_rs_high.heartage,ch_rs_high.heartage,rs.heartage)
msg+='<p>'+root.text_data.Results[skipped].text.replace('[heart_age_low]','<span class="emphasis">'+heart_age_low+'</span>').replace('[heart_age_high]','<span class="emphasis">'+heart_age_high+'</span>')+'</p>'
msg+='<strong>'+root.text_data.TextAreas.result_summary+'</strong>'}else{msg+='<p>'
if(obj.age>rs.heartage){msg+=root.text_data.Results.younger.text}else if(Math.floor(obj.age)==rs.heartage){msg+=root.text_data.Results.same.text}else{msg+=root.text_data.Results.older.text}
msg+='</p><p><strong>'+root.text_data.TextAreas.result_summary+'</strong></p>'}
$('#r3').html(msg)
if(obj.age<40){$('#r4').html('<h3>'+root.text_data.TextAreas.footer_title+'</h3>'+root.text_data.TextAreas.footer_under_40)}else{$('#r4').html('<h3>'+root.text_data.TextAreas.footer_title+'</h3>'+root.text_data.TextAreas.footer_over_40)
if(root.qstr.layout=='phone'){var tmp=$('#footer_img').detach()
$('#r4').prepend(tmp)}}
$advice_wrap.html('')
for(var i in advice_obj){if(!(advice_obj[i].title=='Smoking'&&obj.smoke_cat==0)){var result_obj=root.text_data[advice_obj[i].result_key]
var val=eval(advice_obj[i].val)
if(skipped.indexOf(advice_obj[i].key)>-1){val=10000;}
var result_set=null
var rso=result_obj
if(advice_obj[i].title=='Weight'){if($.inArray(obj.ethrisk,eth_alt)>=0){rso=result_obj.slice(5,9)}else{rso=result_obj.slice(0,4)}}
if(advice_obj[i].title=='Cholesterol'){var tc=obj.tc;}
for(var j in rso){result_set=rso[j]
if(eval(val+' '+rso[j].bracket)){break}}
var msg=result_set.text
if(val==10000&&advice_obj[i].title=='Cholesterol'){msg=result_set.text.replace('[ch_low]','<strong>'+ch_rs_low.heartage+'</strong>')
msg=msg.replace('[ch_high]','<strong>'+ch_rs_high.heartage+'</strong>')}
if(val==10000&&advice_obj[i].title=='Blood pressure'){msg=result_set.text.replace('[bp_low]','<strong>'+bp_rs_low.heartage+'</strong>')
msg=msg.replace('[bp_high]','<strong>'+bp_rs_high.heartage+'</strong>')}
if(advice_obj[i].title=='Blood pressure'){msg=msg.replace('[bp]',obj.sbp)}
var output='<div class = "advice_row">'
output+='<img src = "images/'+advice_obj[i].title.replace(' ','')+root.img_str+'.png" alt = "'+advice_obj[i].title+' icon" width="52"  height ="52">'
output+='<h3>'+advice_obj[i].title+'</h3>'
if(skipped.indexOf(advice_obj[i].key)>-1){output+='<div class="advice_status" style = "color:#e81e26;">Not known - GET TESTED</div>'}else{var status_str=advice_obj[i].advice_status
status_str=status_str.replace('[qval]',eval(advice_obj[i].qval)).replace('[risk]',result_set.type)
output+='<div class="advice_status">'+status_str+'</div>'}
output+='<p>'+msg+'</p>'
output+='</div>'
output+='<a href = "javascript:;" id = "infoDB_'+i+'"><div class="advice_action_bar"><img src = "images/whiteArrow@2x.png" width = "12" height = "12"><h2>'+result_set.contenttitle+'</h2></div></a>'
output+='<div id = "infoDD_'+i+'" class = "info_drop_down">'
var items=result_set.resource.split(',')
for(var j in items){var rObj=root.text_data.Resources[items[j]]
output+='<div class = "info_item">'
if(rObj.image!=''){output+='<a href = "'+rObj.url+'" tabindex = "-1" target="_blank"><img border = "0" alt="'+rObj.imagealt+'" src = "'+root.asset_dir+'/'+rObj.image+'"></a>'}else{output+='<a href = "javascript:;" tabindex = "-1" ><img border = "0" src = "resources/placeholder.png"></a>'}
output+='<p>'+rObj.description+'</p></div>'}
output+='</div>'
$advice_wrap.append(output)
$('#infoDB_'+i).on('click',function(e){self.toggleInfo(e)})
$('#infoDB_'+i).on('mouseover',function(e){self.infoTint(e,1)})
$('#infoDB_'+i).on('mouseout',function(e){self.infoTint(e,0)})
$('#infoDB_'+i).on('focusin',function(e){self.infoTint(e,1)})
$('#infoDB_'+i).on('focusout',function(e){self.infoTint(e,0)})}}
$('.info_drop_down a').on('click',function(e){self.logLink(e)})
$('#r4 a').on('click',function(e){self.logLink(e)})
root.trackHeight()
setTimeout(function(){self.counter(0,rs.heartage)
var life=(1.66666*(Math.max(Math.min(Math.floor(rs['life'])-40,60),0)))
$('#life_bar_fill').animate({'width':life+'%'},1500,'easeOutQuad')},self.counter_delay)
self.resizeLayout()
delete rs,ch_rs_low,ch_rs_high,bp_rs_low,bp_rs_high}
this.infoTint=function(e,opt){var id=e.target.parentNode.id.split('_')[1]
if(e.target.tagName!='DIV'){id=e.target.parentNode.parentNode.id.split('_')[1]}
if(e.target.tagName=='A'){id=e.target.id.split('_')[1]}
if(opt==1){$('#infoDB_'+id+' div').css('background-color','#146bba')}else{$('#infoDB_'+id+' div').css('background-color','#1885e7')}}
this.counter=function(start,num){self.counter_delay=root.speed*5.5
var inc=20
var count=start
var t=0
function stepNext(){setTimeout(function(){if(count<=num){$r1_heart_age.html(count)
count++
if(count>num-15){inc*=1.08}
stepNext()}},inc)}
stepNext()}
this.tidyUp=function(){for(var i in advice_obj){$('#infoDB_'+i).off('click')}}
this.getData=function(obj){if(rs!=null){obj.lf=rs.life.toFixed(2)
obj.h=rs.heartage
obj.links=self.data.links.join('|')
obj.more=self.data.more
obj.exit=self.data.exit}
return obj}
this.toggleInfo=function(e){self.data.more=1
var id=e.target.parentNode.id.split('_')[1]
if(e.target.tagName!='DIV'){id=e.target.parentNode.parentNode.id.split('_')[1]}
if(e.target.tagName=='A'){id=e.target.id.split('_')[1]}
var pad=22
if(root.qstr.layout=='phone'){pad=32
$('#infoDB_'+id+' div').css('background-color','#146bba')}
if(advice_obj[id].info){$('#infoDD_'+id).animate({opacity:0,height:0},root.spd,function(){$('#infoDD_'+id+' a').attr('tabindex',-1)
$('#infoDD_'+id).css('display','none')})
setTimeout(function(){$('#infoDB_'+id+' div').css('background-color','#1885e7')},100)
$('#infoDB_'+id+' img').attr('src','images/whiteArrow@2x.png')
advice_obj[id].info=false}else{$('#infoDD_'+id+' a').attr('tabindex',null)
$('#infoDD_'+id).show().animate({opacity:1,height:($('#infoDD_'+id+'>div').height()+pad)},root.spd,function(){self.resizeLayout()})
setTimeout(function(){$('#infoDB_'+id+' div').css('background-color','#1885e7')},100)
$('#infoDB_'+id+' img').attr('src','images/whiteArrowDn@2x.png')
advice_obj[id].info=true}
root.trackHeight()}}

var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)?true:false;},Tablet:function(){return navigator.userAgent.match(/iPad|(?!.*mobile).*Android*/i)?true:false;},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)?true:false;},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)?true:false;},Windows:function(){return navigator.userAgent.match(/IEMobile/i)?true:false;},any:function(){return(isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows());}};var loadjscssfile=function(filename,filetype){if(filetype=="js"){var fileref=document.createElement('script')
fileref.setAttribute("type","text/javascript")
fileref.setAttribute("src",filename)}
else if(filetype=="css"){var fileref=document.createElement("link")
fileref.setAttribute("rel","stylesheet")
fileref.setAttribute("type","text/css")
fileref.setAttribute("href",filename)}
if(typeof fileref!="undefined"){document.getElementsByTagName("head")[0].appendChild(fileref)}}
function keyEvtNumeric(e){if((e.keyCode>=48&&e.keyCode<=57)||(e.keyCode>=96&&e.keyCode<=105)||e.keyCode==46||e.keyCode==8){return true;}else{return false;}}
function inObj(o,l,r){if(r!=null&&typeof r!='undefined'){o[l]=r;}}
function replaceAll(str,mapObj){var re=new RegExp(Object.keys(mapObj).join("|"),"gi");return str.replace(re,function(matched){return mapObj[matched.toLowerCase()];});}
var arrayUnique=function(a){return a.reduce(function(p,c){if(p.indexOf(c)<0)p.push(c);return p;},[]);};function getUrlVars()
{var vars=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');for(var i=0;i<hashes.length;i++)
{hash=hashes[i].split('=');vars.push(hash[0]);vars[hash[0]]=hash[1];}
return vars;}

window.webtrendsAsyncInit=function(){var dcs=new Webtrends.dcs().init({dcsid:"dcss9yzisf9xjyg74mgbihg8p_8d2u",domain:"statse.webtrendslive.com",timezone:0,i18n:true,adimpressions:true,adsparam:"WT.ac",offsite:true,download:true,downloadtypes:"xls,doc,pdf,txt,csv,zip,docx,xlsx,rar,gzip",onsitedoms:"nhs.uk",fpcdom:".www.nhs.uk",plugins:{hm:{src:"//s.webtrends.com/js/webtrends.hm.js"}}}).track();};(function(){var s=document.createElement("script");s.async=true;s.src="js/webtrends.min.js";var s2=document.getElementsByTagName("script")[0];s2.parentNode.insertBefore(s,s2);}());
